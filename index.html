<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PathFinder AcatlÃ¡n</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="layout">

    <!-- Imagen grande del lado IZQUIERDO -->
    <div class="left-image">
        <img src="/static/img.jpg" alt="Robot amigable">
    </div>

    <!-- CONTENEDOR DEL CHATBOT -->
    <div class="right-panel">

        <div class="header-title">
            <h1>PathFinder AcatlÃ¡n</h1>

        <div class="subtitle-row">
            <p class="subtitle">Chatbot de rutas para estudiantes de nuevo ingreso</p>
        <span class="tag">Proyecto MatemÃ¡ticas Discretas | Areli SÃ¡nchez Alonso</span>
        </div>
    </div>

        <div class="chatbox">
            <div id="chat-window">
                <div class="msg-bot">
                    <p>Hola ðŸ‘‹ Soy PathFinder AcatlÃ¡n.</p>
                    <p>Selecciona tu punto de partida y tu destino, y te mostrarÃ© una ruta sugerida dentro de la FES.</p>
                </div>
            </div>
        </div>

        <div class="controls">
    <label>Â¿Desde dÃ³nde sales?</label>
    <select id="origen">
        {% for lugar in lugares %}
        <option value="{{ lugar }}">{{ lugar }}</option>
        {% endfor %}
    </select>

    <label>Â¿A dÃ³nde quieres llegar?</label>
    <select id="destino">
        {% for lugar in lugares %}
        <option value="{{ lugar }}">{{ lugar }}</option>
        {% endfor %}
    </select>

    <div class="buttons">
        <button onclick="calcularRuta()">Calcular ruta</button>
        <button onclick="limpiarChat()" class="secondary">Limpiar chat</button>
    </div>

    <p class="tip">
        Puedes cambiar origen y destino cuando quieras. Gracias por usar PathFinder AcatlÃ¡n. Â¡Que tengas un gran dÃ­a en la FES! âœ¨ 
    </p>
</div>
        </div>
</div>

<script src="/static/script.js"></script>

<script>
  const chatWindow = document.getElementById("chat-window");
  const origenSelect = document.getElementById("origen");
  const destinoSelect = document.getElementById("destino");

  function ahora() {
    const f = new Date();
    return f.toLocaleTimeString("es-MX", { hour: "2-digit", minute: "2-digit" });
  }

  function agregarMensaje(tipo, texto) {
    const msg = document.createElement("div");
    msg.classList.add(tipo === "user" ? "msg-user" : "msg-bot");

    const p = document.createElement("p");
    p.textContent = texto;

    const time = document.createElement("div");
    time.classList.add("time");
    time.textContent = ahora();

    msg.appendChild(p);
    msg.appendChild(time);

    chatWindow.appendChild(msg);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  async function calcularRuta() {
    const origen = origenSelect.value;
    const destino = destinoSelect.value;

    if (!origen || !destino) {
      agregarMensaje("bot", "Por favor selecciona origen y destino.");
      return;
    }

    if (origen === destino) {
      agregarMensaje("bot", `Ya te encuentras en ${origen}.`);
      return;
    }

    // mensaje del usuario
    agregarMensaje("user", `Quiero ir de ${origen} a ${destino}.`);

    try {
      const resp = await fetch("/ruta", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ origen, destino })
      });

      const data = await resp.json();

      if (data.error) {
        agregarMensaje("bot", data.error);
      } else {
        const ruta = data.ruta.join(" â†’ ");
        agregarMensaje("bot", `Ruta sugerida:\n${ruta}`);
      }
    } catch (e) {
      agregarMensaje("bot", "OcurriÃ³ un error al calcular la ruta. Intenta de nuevo.");
    }
  }

  function limpiarChat() {
    chatWindow.innerHTML = `
      <div class="msg-bot">
        <p>Hola ðŸ‘‹ Soy PathFinder AcatlÃ¡n.</p>
        <p>Selecciona tu punto de partida y tu destino, y te mostrarÃ© una ruta sugerida dentro de la FES.</p>
      </div>
    `;
  }
</script>
</body>
</html>
